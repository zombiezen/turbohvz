<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">

<py:def function="page_title">Game <span py:replace="game.game_id">#</span> - <span py:replace="game.display_name">[name]</span></py:def>
<py:def function="head_info">
<script type="text/javascript">
function unjoin(evt)
{
    var unjoin_url = ${tg.jsencode(tg.hvz.game_link(game, 'action.unjoin'))};
    var msg = ${tg.jsencode(_("Are you sure you want to remove yourself from the game?"))};
    confirm_action(msg, unjoin_url);
}
function delete_game(evt)
{
    var delete_url = ${tg.jsencode(tg.hvz.game_link(game, 'action.delete'))};
    var msg = ${tg.jsencode(_("Are you sure you want to delete the game?"))};
    confirm_action(msg, delete_url);
}

function confirm_action(msg, url)
{
    if (confirm(msg))
    {
        window.location = url;
    }
}
</script>
<style type="text/css">
    #game_info
    {
        border: none;
    }
    
    #game_info th, .game_info td
    {
        color: black;
        background: none;
        border: none;
    }
    
    #game_info th
    {
        font-weight: bold;
        text-align: right;
        vertical-align: top;
    }
    
    .check
    {
        color: green;
    }
</style>
</py:def>

<py:def function="pluralize(val, single, plural)"><py:choose><py:when test="val == 1">${single}</py:when><py:otherwise>${plural}</py:otherwise></py:choose></py:def>

<py:match path="content">
    <a id="sect_game_info"></a>
    <table id="game_info">
        <tr>
            <th>Created:</th>
            <td><span class="date" py:content="tg.display_date(game.created)">[date]</span></td>
        </tr>
        <tr>
            <th>Started:</th>
            <td><span py:choose="" py:strip=""><span py:when="game.started is None" py:strip="">Not yet started</span><span py:otherwise="" class="date" py:content="tg.display_date(game.started)">[date]</span></span></td>
        </tr>
        <tr>
            <th>Ended:</th>
            <td><span py:choose="" py:strip=""><span py:when="game.started is None" py:strip="">Not yet started</span><span py:when="game.ended is None" py:strip="">In progress</span><span py:otherwise="" class="date" py:content="tg.display_date(game.ended)">[date]</span></span></td>
        </tr>
        <tr>
            <th>Starve Time:</th>
            <td>
                <span py:replace="game.zombie_starve_time">[#]</span>
                <span py:replace="pluralize(game.zombie_starve_time, _('hour'), _('hours'))">[hour(s)]</span>
            </td>
        </tr>
        <tr py:if="game.ignore_weekdays"
            py:with="weekdays = sorted(game.ignore_weekdays)">
            <th>Ignores weekdays:</th>
            <td>
                <ul>
                    <li py:for="day in weekdays"
                        py:content="tg.display_weekday(day)">[day]</li>
                </ul>
            </td>
        </tr>
        <tr py:if="game.ignore_dates"
            py:with="dates = sorted(game.ignore_dates)">
            <th>Holidays:</th>
            <td>
                <ul>
                    <li py:for="date in dates"
                        py:content="tg.display_date(date)">[date]</li>
                </ul>
            </td>
        </tr>
    </table>
    <div py:if="'delete-game' in tg.identity.permissions">
        <button py:if="'delete-game' in tg.identity.permissions" onclick="delete_game(event);">Delete</button>
    </div>
    <py:if test="current_entry is not None">
        <h2 id="sect_player_info">Your Info</h2>
        <ul>
            <li>Your ID is <span py:replace="current_entry.player_gid">[gid]</span></li>
            <li>You are <span py:replace="current_entry.affiliation">[affiliation]</span></li>
            <li py:if="not current_entry.is_human and current_entry.killed_by is not None">You were killed by <a href="${tg.hvz.user_link(current_entry.killed_by)}" class="player" py:content="current_entry.killed_by">[user]</a></li>
            <li py:if="not current_entry.is_human">
                You have killed
                <span py:replace="current_entry.kills">[#]</span>
                <span py:replace="pluralize(current_entry.kills, _('player'), _('players'))">[player(s)]</span>
            </li>
            <li py:if="current_entry.is_dead">You starved on <span py:replace="tg.display_date(current_entry.starve_date)">[date]</span></li>
        </ul>
        <div py:if="game.in_progress">
            <button py:if="current_entry.is_undead" onclick="window.location=${tg.jsencode(tg.hvz.game_link(game, 'reportkill'))};">Report Kill</button>
        </div>
    </py:if>
    <h2 id="sect_entry_list">Player Roster</h2>
    <span py:replace="tg.display(grid, game.entries)">[players]</span>
    <div py:if="not tg.identity.anonymous">
        <button py:if="game.registration_open and current_entry is not None" onclick="unjoin(event);">Unjoin</button>
        <button py:if="'join-game' in tg.identity.permissions and game.registration_open and current_entry is None" onclick="${tg.jsencode(tg.hvz.game_link(game, 'join'))}">Join</button>
    </div>
    <h2 id="sect_stage">Stage</h2>
    <table id="stage_table">
        <tr>
            <td class="check"><py:if test="game.state >= 0">&#x2713;</py:if></td>
            <td>Game created</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 1">&#x2713;</py:if></td>
            <td>Open registration</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 2">&#x2713;</py:if></td>
            <td>Closed registration</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 3">&#x2713;</py:if></td>
            <td>Choose original zombie</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 4">&#x2713;</py:if></td>
            <td>Start game</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 5">&#x2713;</py:if></td>
            <td>Reveal original zombie</td>
        </tr>
        <tr>
            <td class="check"><py:if test="game.state >= 6">&#x2713;</py:if></td>
            <td>Game over</td>
        </tr>
    </table>
    <form py:if="'stage-game' in tg.identity.permissions" action="${tg.url('/game/action.stage')}">
        <p>
            <input type="hidden" name="game_id" value="${game.game_id}" />
            <input py:if="not game.is_first_state" type="submit" name="btnPrev" value="Previous Stage" />
            <input py:if="not game.is_last_state" type="submit" name="btnNext" value="Next Stage" />
        </p>
    </form>
</py:match>

<xi:include href="../master.html" />

</html>
